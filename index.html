import React, { useState, useEffect } from "react";

export default function DigitalBalanceApp() {
  const [activePage, setActivePage] = useState("home");
  const [usageTime, setUsageTime] = useState(0);
  const [alarms, setAlarms] = useState([]);
  const [alarmInput, setAlarmInput] = useState("");
  const [chat, setChat] = useState([]);
  const [message, setMessage] = useState("");

  useEffect(() => {
    const interval = setInterval(() => setUsageTime((prev) => prev + 1), 1000);
    return () => clearInterval(interval);
  }, []);

  const addAlarm = () => {
    if (alarmInput) {
      setAlarms([...alarms, alarmInput]);
      setAlarmInput("");
      alert(`ìŠ¤íŠ¸ë ˆì¹­ ì•ŒëŒì´ ${alarmInput}ì— ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
  };

  const sendMessage = () => {
    if (message.trim() === "") return;
    const newChat = [...chat, { from: "user", text: message }];
    setChat(newChat);
    setMessage("");
    setTimeout(() => {
      setChat([...newChat, { from: "bot", text: "ì˜¤ëŠ˜ë„ ìˆ˜ê³ í–ˆì–´ìš” ğŸŒ¿ ë§ˆìŒì´ ë‹µë‹µí•  ë•ŒëŠ” ì ê¹ ì‹¬í˜¸í¡ì„ í•´ë³´ì„¸ìš”." }]);
    }, 800);
  };

  const stretches = {
    wrist: [
      "ì–‘ íŒ”ì„ ì•ìœ¼ë¡œ ì­‰ ë»—ê³  ì†ë°”ë‹¥ì„ ì•„ë˜ë¡œ í–¥í•˜ê²Œ í•©ë‹ˆë‹¤.",
      "í•œ ì†ìœ¼ë¡œ ë°˜ëŒ€ ì†ê°€ë½ì„ ì¡ì•„ ì²œì²œíˆ ëª¸ ìª½ìœ¼ë¡œ ë‹¹ê²¨ì¤ë‹ˆë‹¤.",
      "ì†ëª© ì•ˆìª½ ê·¼ìœ¡ì´ ëŠ˜ì–´ë‚˜ëŠ” ëŠë‚Œì´ ë“¤ë©´ 15ì´ˆê°„ ìœ ì§€í•©ë‹ˆë‹¤.",
      "ë°˜ëŒ€ ì†ë„ ë™ì¼í•˜ê²Œ ë°˜ë³µí•©ë‹ˆë‹¤."
    ],
    neck: [
      "ë°”ë¥´ê²Œ ì•‰ì€ ìƒíƒœì—ì„œ ì–´ê¹¨ë¥¼ ë‚´ë¦¬ê³  ê³ ê°œë¥¼ ì²œì²œíˆ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê¸°ìš¸ì…ë‹ˆë‹¤.",
      "ì†ìœ¼ë¡œ ë¨¸ë¦¬ë¥¼ ì‚´ì§ ëˆŒëŸ¬ ëª© ì˜† ê·¼ìœ¡ì„ ìŠ¤íŠ¸ë ˆì¹­í•©ë‹ˆë‹¤.",
      "15ì´ˆ ìœ ì§€ í›„ ì™¼ìª½ë„ ë™ì¼í•˜ê²Œ ë°˜ë³µí•©ë‹ˆë‹¤.",
      "ë§ˆì§€ë§‰ìœ¼ë¡œ ê³ ê°œë¥¼ ì•ë’¤ë¡œ ì²œì²œíˆ ëŒë ¤ ê·¼ìœ¡ì„ í’€ì–´ì¤ë‹ˆë‹¤."
    ],
    shoulder: [
      "í•œìª½ íŒ”ì„ ê°€ìŠ´ ì•ìœ¼ë¡œ ê°€ì ¸ì™€ ë°˜ëŒ€ì†ìœ¼ë¡œ íŒ”ê¿ˆì¹˜ë¥¼ ê°ì‹¸ì¤ë‹ˆë‹¤.",
      "íŒ”ì„ ëª¸ ìª½ìœ¼ë¡œ ì²œì²œíˆ ë‹¹ê¸°ë©° ì–´ê¹¨ ë’¤ìª½ ê·¼ìœ¡ì„ ìŠ¤íŠ¸ë ˆì¹­í•©ë‹ˆë‹¤.",
      "15ì´ˆê°„ ìœ ì§€ í›„ ë°˜ëŒ€ìª½ë„ ë°˜ë³µí•©ë‹ˆë‹¤.",
      "ëìœ¼ë¡œ ì–‘íŒ”ì„ ë’¤ë¡œ ê¹ì§€ ë¼ê³  ê°€ìŠ´ì„ ì—´ì–´ì¤ë‹ˆë‹¤."
    ]
  };

  const renderPage = () => {
    switch (activePage) {
      case "stretchAlarm":
        return (
          <div className="p-5">
            <h2 className="text-xl font-bold text-mint-600 mb-3">ìŠ¤íŠ¸ë ˆì¹­ ì•ŒëŒ ì„¤ì •</h2>
            <div className="flex gap-2 mb-3">
              <input
                type="time"
                value={alarmInput}
                onChange={(e) => setAlarmInput(e.target.value)}
                className="border-2 border-mint-300 focus:border-blue-400 rounded-lg p-2 w-2/3"
              />
              <button
                onClick={addAlarm}
                className="bg-gradient-to-r from-blue-400 to-mint-400 text-white px-4 py-2 rounded-lg shadow-md"
              >
                ì¶”ê°€
              </button>
            </div>
            <ul className="space-y-2">
              {alarms.length === 0 ? (
                <li className="text-gray-400">â° ì„¤ì •ëœ ì•ŒëŒì´ ì—†ìŠµë‹ˆë‹¤.</li>
              ) : (
                alarms.map((a, i) => <li key={i}>â° {a}</li>)
              )}
            </ul>
          </div>
        );
      case "stretchGuide":
        return (
          <div className="p-5">
            <h2 className="text-xl font-bold text-blue-600 mb-4">íš¨ê³¼ì ì¸ ìŠ¤íŠ¸ë ˆì¹­ ë°©ë²•</h2>
            <div className="grid grid-cols-1 gap-3">
              {Object.entries(stretches).map(([key, steps]) => (
                <div key={key} className="bg-white border-2 border-mint-200 rounded-2xl shadow-md p-4">
                  <h3 className="font-semibold text-lg text-blue-600 mb-2">
                    {key === "wrist" ? "ì†ëª© ìŠ¤íŠ¸ë ˆì¹­" : key === "neck" ? "ëª© ìŠ¤íŠ¸ë ˆì¹­" : "ì–´ê¹¨ ìŠ¤íŠ¸ë ˆì¹­"}
                  </h3>
                  <ul className="list-disc list-inside text-gray-600">
                    {steps.map((s, i) => (
                      <li key={i}>{s}</li>
                    ))}
                  </ul>
                </div>
              ))}
            </div>
          </div>
        );
      case "pomodoro":
        return <PomodoroTimer />;
      case "aiChat":
        return (
          <div className="p-4">
            <h2 className="text-xl font-bold text-blue-600 mb-2">AI ì •ì‹  ìƒë‹´</h2>
            <div className="bg-gray-50 border rounded-xl h-60 overflow-y-auto p-3 mb-2 shadow-inner">
              {chat.map((c, i) => (
                <div key={i} className={`mb-1 ${c.from === "user" ? "text-right" : "text-left text-gray-700"}`}>
                  <span className={`inline-block px-3 py-1 rounded-2xl ${c.from === "user" ? "bg-blue-400 text-white" : "bg-mint-200"}`}>
                    {c.text}
                  </span>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input
                type="text"
                value={message}
                onChange={(e) => setMessage(e.target.value)}
                className="border-2 border-mint-300 rounded-lg p-2 flex-grow"
                placeholder="ì§€ê¸ˆ ê¸°ë¶„ì´ ì–´ë•Œìš”?"
              />
              <button onClick={sendMessage} className="bg-blue-400 text-white px-3 py-2 rounded-lg">
                ì „ì†¡
              </button>
            </div>
          </div>
        );
      default:
        return (
          <div className="text-center py-10">
            <div className="flex flex-col items-center mb-6">
              <div className="w-24 h-24 bg-gradient-to-r from-blue-400 to-mint-400 rounded-full shadow-lg flex items-center justify-center text-white text-3xl font-bold animate-pulse">
                ğŸŒ±
              </div>
            </div>
            <h2 className="text-2xl font-bold text-blue-600 mb-2">ì˜¤ëŠ˜ ì‚¬ìš©ì‹œê°„</h2>
            <p className="text-4xl font-mono text-mint-500 mb-2">{usageTime}s</p>
            <p className="text-gray-600">ë””ì§€í„¸ ë°¸ëŸ°ìŠ¤ë¡œ ê±´ê°•í•œ í•˜ë£¨ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš” ğŸ’«</p>
          </div>
        );
    }
  };

  return (
    <div className="max-w-sm mx-auto bg-gradient-to-b from-blue-50 to-mint-50 rounded-3xl shadow-lg h-[90vh] flex flex-col justify-between overflow-hidden">
      <header className="flex justify-between items-center bg-gradient-to-r from-blue-400 to-mint-400 text-white px-4 py-3 rounded-b-3xl shadow-md">
        <h1 className="text-xl font-bold">ë””ì§€í„¸ ë°¸ëŸ°ìŠ¤</h1>
        <span className="text-sm">â± {usageTime}s</span>
      </header>

      <main className="flex-grow overflow-y-auto">{renderPage()}</main>

      <nav className="grid grid-cols-4 bg-white border-t-2 border-mint-200 text-center py-2">
        <button onClick={() => setActivePage("stretchAlarm")} className="text-blue-500 hover:text-blue-700 text-sm">
          ì•ŒëŒ
        </button>
        <button onClick={() => setActivePage("stretchGuide")} className="text-blue-500 hover:text-blue-700 text-sm">
          ìŠ¤íŠ¸ë ˆì¹­
        </button>
        <button onClick={() => setActivePage("pomodoro")} className="text-blue-500 hover:text-blue-700 text-sm">
          íƒ€ì´ë¨¸
        </button>
        <button onClick={() => setActivePage("aiChat")} className="text-blue-500 hover:text-blue-700 text-sm">
          ìƒë‹´
        </button>
      </nav>
    </div>
  );
}

function PomodoroTimer() {
  const [customMinutes, setCustomMinutes] = useState(25);
  const [time, setTime] = useState(customMinutes * 60);
  const [isRunning, setIsRunning] = useState(false);

  useEffect(() => {
    let timer;
    if (isRunning) {
      timer = setInterval(() => {
        setTime((t) => (t > 0 ? t - 1 : 0));
      }, 1000);
    }
    return () => clearInterval(timer);
  }, [isRunning]);

  useEffect(() => setTime(customMinutes * 60), [customMinutes]);

  const minutes = Math.floor(time / 60);
  const seconds = time % 60;
  const percent = (time / (customMinutes * 60)) * 100;

  return (
    <div className="text-center p-4 flex flex-col items-center">
      <h2 className="text-xl font-bold text-mint-600 mb-4">í¬ëª¨ë„ë¡œ íƒ€ì´ë¨¸</h2>

      <div className="relative w-52 h-52 mb-4">
        <svg className="absolute top-0 left-0 w-full h-full rotate-[-90deg]">
          <circle cx="104" cy="104" r="100" stroke="#e0f7fa" strokeWidth="8" fill="none" />
          <circle
            cx="104"
            cy="104"
            r="100"
            stroke="#3b82f6"
            strokeWidth="10"
            fill="none"
            strokeDasharray={2 * Math.PI * 100}
            strokeDashoffset={(2 * Math.PI * 100 * (100 - percent)) / 100}
            strokeLinecap="round"
          />
        </svg>
        <div className="absolute inset-0 flex flex-col items-center justify-center">
          <span className="text-2xl font-mono text-blue-600">
            {minutes}:{seconds.toString().padStart(2, "0")}
          </span>
          <span className="text-gray-500 text-sm mt-1">{Math.round(percent)}%</span>
        </div>
      </div>

      <div className="flex justify-center gap-2 mb-3">
        <input
          type="number"
          min="1"
          max="60"
          value={customMinutes}
          onChange={(e) => setCustomMinutes(Number(e.target.value))}
          className="w-16 border-2 border-mint-300 rounded-lg text-center"
        />
        <span className="text-gray-600">ë¶„</span>
      </div>
      <div className="space-x-2">
        <button
          onClick={() => setIsRunning(!isRunning)}
          className="bg-gradient-to-r from-blue-400 to-mint-400 text-white px-4 py-2 rounded-lg shadow-md"
        >
          {isRunning ? "ì¼ì‹œì •ì§€" : "ì‹œì‘"}
        </button>
        <button onClick={() => setTime(customMinutes * 60)} className="bg-gray-200 px-4 py-2 rounded-lg">
          ì´ˆê¸°í™”
        </button>
      </div>
    </div>
  );
}
